---

- 

  hosts: all
  become: yes
  become_method: sudo 
  become_user: root 
  connection: ssh
  tasks:
    - name: update ubuntu system 
      apt:
        update_cache=yes
    - name: upload the kernal module
      modprobe:
        name: "{{item}}"
        state: present 
      with_items:
        - overlay
        - br_netfilter
    
    - name: turn sysctl parameters in /proc 
      sysctl:
        name: "{{item}}"
        value: '1'
        sysctl_set: yes
        state: present 
      with_items:
        - net.bridge.bridge-nf-call-iptables
        - net.bridge.bridge-nf-call-ip6tables
        - net.ipv4.ip_forward    
    
    - name: install container d as platform
      shell:
        sudo apt-get update && sudo apt-get install -y containerd
        sudo mkdir -p /etc/containerd 
        sudo containerd config default |sudo tee /etc/containerd/config.toml
        sudo systemctl restart containerd
          
     